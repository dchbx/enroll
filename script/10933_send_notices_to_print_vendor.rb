FEINS= ["522274246",
"521989809", "237116952", "010579796", "360723070", "521255580", "521773753", "530184647", "770660747", "521660323",
"272111884", "522208743", "521538798", "521682622", "161618560", "134240527", "462163942", "521773366", "208396685", 
"204139416", "522328178", "522284899", "462395327", "521743079", "522189003", "521948450", "810594787", "261567527", 
"521572879", "262117013", "522143048", "521363952", "371507349", "541111836", "270145144", "260252534", "133276866",
"860947831", "200798736", "460682130", "542029779", "043186073", "521285505", "521597011", "522122445", "134250162", 
"760781481", "521403004", "521463503", "521119974", "540610447", "541464084", "262012038", "260038632", "521118504",
"522318905", "320059779", "202580233", "455225301", "680547548", "521735841", "521606521", "521650031", "521506104",
"541152136", "462450336", "522057561", "521255008", "521700108", "000000059", "520845886", "522235210", "521162185",
"521149169", "522183112", "522067896", "541836677", "530219643", "461439710", "362327263", "000000050", "521255381",
"521961615", "471492093", "412106721", "273842063", "237391766", "462223015", "521869979", "521915015", "520958310",
"520897278", "311542973", "262557859", "520848094", "980452719", "274585278", "830420407", "520802034", "450499992",
"421723890", "522210910", "272589206", "000000060", "300045955", "520788123", "521912065", "161694206", "522042590",
"521664004", "203050325", "320045822", "366108621", "521648942", "205917278", "264186602", "521039553", "522183978",
"521150317", "320313719", "020679563", "521372239", "521033295", "522285212", "303522310", "522031287", "521603412",
"820576016", "521778593", "521848952", "452048444", "521231229", "800639340", "161769129", "521259375", "521270178",
"521226787", "203371518", "530222939", "522158009", "000000058", "530222329", "522007652", "522334838", "263995027",
"520899083", "201373415", "522271068", "371425445", "201608105", "272183541", "522201998", "260842185", "770415802",
"237087038", "521602517", "521433877", "520788793", "232290483", "113827089", "521072749", "133246732", "521127504",
"521973408", "521529937", "264262939", "133462504", "521204930", "521115162", "530225499", "521460585", "522140838",
"521210386", "133218529", "510347864", "452803651", "270245221", "571144964", "521831538", "521982401", "364499034",
"363820023", "522156813", "521669676", "203714244", "522336690", "522302093", "521876835", "520849514", "954300662",
"521395855", "043818707", "541868658", "521919595", "521098206", "800490699", "270793211", "352218466", "311799561",
"274773127", "232188166", "521239943", "561674868", "521600093", "521347584", "463305496", "521970360", "460482657",
"510160220", "521616482", "522013283", "203917354", "521715980", "208725963", "452803870", "260752659", "363895800",
"520981992", "522269332", "132966004", "521859975", "203344285", "453322024", "680635707", "271623883", "521175853",
"033549315", "521639499", "270008571", "043828812", "300080738", "521232211", "521772575", "522109039", "260129773",
"520955161", "263705798", "541920500", "530214064", "273754186", "352189643", "521249353", "273337800", "270496005",
"522298459", "521286378", "201818541", "521055648", "521323953", "522220226", "521186277"]

FEINS.each do |fein|
  organization = Organization.where(:fein => fein).first
  invoices = organization.invoices.select {|i| i.date == DateTime.parse("2016-09-14") }
  dir_name = "invoices_to_send"
  dir=FileUtils.mkdir_p(dir_name)
  invoices.each do |i|
    file_content= Aws::S3Storage.new.find(i.identifier)
    t=File.new([dir,i.title].join('/'),'w')
    t.binmode
    t.write(file_content)
    t.close
  end
	
  puts "creating a tar file now"
  system("tar -zcvf #{dir_name}.tar.gz #{dir_name}")
  puts "Folder created!"
end