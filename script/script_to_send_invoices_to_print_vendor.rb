FEINS= ["371453243","521837305","383943185","521008522","530115970","870469987","760834735","521807403","270779769",
  "465746176","473576918","463761747","471315917","464197120","473823101","205319952","474739210","710891642",
  "473029807","471679070","203133688","521295497","471690278","201813984","521978822","201766192","043735844",
  "471611374","521107937","050567587","274005277","521754128","272020795","201909091","473764704","300662452",
  "521706852","471787064","454593764","208874570","223889340","474350038","383971858","463991501","271597232",
  "451592713","261150699","352257526","521684427","521901650","263247482","521659498","522051287","521814742",
  "530027286","920195686","200748404","541206273","208837141","611609478","520991278","330627955","510243577",
  "521235124","263150043","521756243","530219640","742465139","520939894","520948878","522144055","943437682",
  "521058725","522006386","521360541","460687897","522135586","262335843","521803772","521807750","270390893",
  "204314853","521080082","521397615","753130860","541853311","521000466","261558519","521997465","521766976",
  "830495556","205778912","522350551","262335764","522101165","300529814","260319209","521761312","521831679",
  "530159306","521420879","521527015","521301966","030506626","205365479","522318636","521638734","521738875",
  "522301990","260760917","522088262","521480588","274712173","522157224","274937136","454460937","530229573",
  "521388734","521948022","521831841","530205698","310507334","530233291","522132835","521932886","522012785",
  "522222230","000000062","522278623","521379024","521752591","130086433","000000063","521469738","521355654",
  "521072698","465065714","522241644","521615728","464912617","113758506","200475221","262152448","526064548",
  "452941661","520985877","521035995","521127407","520786317","454202732","273439348","521263814","521525134",
  "465308134","562521323","205152832","981008743","530214273","208114949","452826015","521084149","521263426",
  "204229835","522023085","521903384","521847137","541993758","542014609","451672898","520958568","521185600",
  "131945157","262633110","421546343","830508801","461771928","841576661","800073170","521971942","521198450",
  "943241464","364729944","521852434","730529079","522100474","320369643","320384285","270856599","050533029",
  "520559568","516405699","521347058","203173864","522331898","521748601","260657494","275379484","454899756",
  "521790519","522141669","520819848","522137176","521864182","521524401","522338813","810620520","205072415",
  "521004804","521524086","530201233","042836360","472874288","522259830","431131436","522071359","521990329",
  "113785484","521305780","521987226","543453452","452804987","521892341","521521691","521802000","521933652",
  "208716871","521226640","452989169","310686464","741162773","954290004","611332655","650328971","870805049",
  "200767664","510141872","043536571","237323629","743229288","362337880","263490284","522329996","541668887",
  "455414913","521502247","521852719","522062599","270541509","521822488","237250499","870766022","521952797",
  "522086742","510653147","810622166","830475677","571206097","237059731","264740078","264391330","203660908",
  "521629221","800884491","030458695","521490413","203940475","521264564","263727917","520882723","113655877",
  "953747267","522143612","204249844","800427390","530218654","520802102","205517244","521257425","452625029",
  "521490485","471746521","522283361","521174165","521701564","200761422","810561016","264559492","461025703",
  "521641087","520982384","522118391","271608593","460742540","461169268","412226446","521262136","521391896",
  "830376581","521637038","200174462","521904320","541743477","651217773","522287023","550894892","521627721",
  "520880522","455582976","900435352","521109501","237026895","636057610","550889748","522193975","541093766",
  "521846918","521820015","522330380","521668188","530159300","271382753","521948142","521585971","010833168",
  "204597308","522281566","264570977","522213834","522151557","208696406","522223745","522296959","300201506",
  "521195818","526055480","521969099","260686330","161135219","363814358","522265096","530245213","530208981",
  "465741527","341978347","813521916","522188311","900530797","202897226","310794522","522346578","132947623",
  "460910121","364537726","980343135","452353390","364668528","611718234","811580562","453540453","203265226",
  "472987114","264686810","475601775","271725791","731651422","275069642","475386723","522309214","813659784",
  "204514853","454999065","271456626","521793984","371779557","273675785","274077417"]

FEINS.each do |fein|
  organization = Organization.where(:fein => fein).first
  invoices = organization.invoices.select {|i| i.date == DateTime.parse("2016-10-14") }
  dir_name = "invoices_to_send"
  dir=FileUtils.mkdir_p(dir_name)
  invoices.each do |i|
    file_content= Aws::S3Storage.new.find(i.identifier)
    t=File.new([dir,i.title].join('/'),'w')
    t.binmode
    t.write(file_content)
    t.close
  end
end
puts "creating a tar file now"
system("tar -zcvf #{dir_name}.tar.gz #{dir_name}")
puts "Folder created!"