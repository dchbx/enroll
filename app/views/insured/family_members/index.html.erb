<% content_for :horizontal_status do %>
  <%= render :partial => 'insured/families/horizontal_status.html.erb', locals: {step: 1} %>
<% end %>
<div class="container">
  <div id="dependents_info_wrapper">
    <div class="row">
      <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
        <%= render :partial => 'shared/left_nav.html.erb' %>
      </div>
      <div class="col-lg-7 col-md-7 col-sm-7 col-xs-12 bottom-pd">

        <% if @change_plan.present? && @sep.blank?%>
           <h3 class="blue-text"><%= params[:change_plan] %>, on: <%= @change_plan_date %></h3>
        <% end %>

        <% if @sep.present? %>
          <h3 class="blue-text"><%= @sep.title %> on: <%= @sep.qle_on %></h3>
        <% end %>

        <h1 class="darkblue">Household Info: Family Members</h1>
        <h4>If you need to get insurance coverage for other members of your household, select 'Add Member'. When youâ€™re finished, select CONTINUE.</h4>
        <p class='memo'>* = required field</p>
        <div class="row row-form-wrapper no-buffer">
          <div class="col-md-12 col-sm-12 col-xs-12 no-pd">
            <div class="col-md-6 col-sm-6 no-pd form-group-lg no-pd">
              <label class="static_label label-floatlabel" for="name">NAME</label>
              <span class="field_value floatlabel form-control active-floatlabel" id="name"><%= "#{@person.first_name} #{@person.middle_name} #{@person.last_name}" %></span>
            </div>
            <div class="col-md-6 col-sm-6 no-pd form-group-lg no-pd">
              <label class="static_label label-floatlabel" for="relation">RELATION</label>
              <span class="field_value floatlabel form-control active-floatlabel" id="relation">Self</span>
              <%= link_to personal_insured_families_path, remote: true, class: 'close close-2' do %>
                <i class="fa fa-pencil"></i>
              <% end %>
            </div>
          </div>
        </div>
        <div class="append_consumer_info">

        </div>
        <%if @family.application_in_progress.present?%>
          <div class="row row-form-wrapper no-buffer">
            <div class="col-md-12 col-sm-12 col-xs-12 no-pd">
              <%= render "financial_assistance_row", family_member: @family.primary_applicant %>
            </div>
          </div>
        <%end%>

        <div class="row no-buffer <%= pundit_class Family, :updateable?%>">
          <div class="fail-search add-member <%= 'hidden' if !@family.active_family_members.empty? %>">
            <div class="col-md-12 col-sm-12 col-xs-12 no-pd">
              <p class="fail"><span class="bold">Here's your chance to add family members to your plan.</span><br>Add family members by clicking the "Add Member" button. If you don't need to add more members, or when you are done adding members, click continue.</p>
              <br>
              <div class="form-inline text-center <%= pundit_class Family, :updateable?%>">
                <%= link_to "Add Member", new_insured_family_member_path(:family_id => @family.id), :remote => true, :class => "btn btn-default" %>
                  &nbsp; &nbsp;
                <a class="text-center btn btn-success">Continue</a>
              </div>
            </div>
          </div>
        </div>

        <br>
        <div class="row no-buffer">
          <ul class="" id="dependent_ul">
            <% @family.active_family_members.reject(&:is_primary_applicant).each do |dependent| %>
              <%= render "dependent", dependent: dependent, person: @person %>
            <% end %>
          </ul>
        </div>

        <div id="dependent_buttons" class="focus_effect personal-info-row <%= 'hidden' if @family.active_family_members.empty? %>">
          <div class="col-md-12 no-pd col-sm-12 col-xs-12 <%= pundit_class Family, :updateable?%>">
            <%= hidden_field_tag 'origin_source', @source %>
            <%= link_to 'Add Member'.html_safe, new_insured_family_member_path(:family_id => @family.id, employee_role_id: @employee_role.try(:id), consumer_role_id: @consumer_role.try(:id)), :remote => true, :class => "btn btn-default", :id => "household_info_add_member" %>
            <% group_selection_url = new_insured_group_selection_path(person_id: @person.id, employee_role_id: @employee_role.try(:id), consumer_role_id: @consumer_role.try(:id), change_plan: @change_plan, market_kind: @market_kind, sep_id: @sep.try(:id), qle_id: @qle.try(:id), effective_on_option_selected: params[:effective_on_option]) %>
            <input type="hidden" value="<%= group_selection_url %>" id="btn_household_continue">

            <% if @change_plan.present? %>
              <%=
                link_to '<i class="fa fa-user-plus"></i> Continue'.html_safe, group_selection_url,
                 class: 'btn btn-primary pull-right' + pundit_class(Family,:updateable?), id: 'btn_household_continue'
              %>
            <% end %>
          </div>
        </div>
      </div>

      <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
        <% find_sep_url = find_sep_insured_families_path(employee_role_id: @employee_role.try(:id), consumer_role_id: @consumer_role.try(:id), change_plan: @change_plan)%>

        <% if @change_plan.present? %>
          <%= render partial: 'shared/qle_progress', locals: {step: '1'} %>
        <% elsif @type == "employee" %>
          <%= render  partial: 'shared/signup_progress', locals: {
            step: '4',
            url: @missing_relationships.present? ? insured_family_relationships_path(:employee_role_id => @employee_role.id) : group_selection_url
          } %>
        <% else %>
          <%= render  partial: 'shared/individual_progress', locals: {
            step: 3,
            url: build_button(@consumer_role, @family, find_sep_url, @missing_relationships).first
          } %>
        <% end %>
      </div>
    </div>
  </div>
</div>
