<% content_for :navigation do %>
<%= render :partial => 'employers/employer_profiles/primary_nav', :locals => {:active_tab=>params[:tab]} %>
<% end %>
<% plan_year, billing_date = @employer_profile.billing_plan_year %>
<div class="premium-reports-tab module">
  <div class="row">
    <div class="col-xs-12">
      <div class="col-xs-9">
        <div class="row">
          <h1 class="darkblue no-buffer">
            Enrollment Reports
          </h1>
        </div>
      </div>
      <% if plan_year.present? && billing_date.present? %>
      <div class="col-xs-3">
        <div class="row">
          <div class="selectric-labeled">
            <span>
              <strong>
                Month:
              </strong>
            </span>
            <%= billing_period_dropdown %>
          </div>
        </div>
      </div>
      <% end %>
    </div>
  </div>
  <% if plan_year.present? && billing_date.present? %>
  <div class="tables premium-reports-table">
    <%= render partial: 'shared/premium_reports_table' %>
  </div>
  <% else %>
  <h4>
    After your employees have enrolled in coverage, your enrollment reports will show here.
  </h4>
  <% end %>
  <% if plan_year.present? && billing_date.present? %>
  <a class='btn btn-default' data-target='#downloadCsv' data-toggle='modal'>
    <i aria-hidden="true" class="fa fa-cloud-download"></i>
    Download</a>
  <% end %>
</div>
</div>

<script>
$(function () {
  $('[data-toggle="tooltip"]').tooltip();
  $('#enrollment_report_dropdown').on('change', function () {
    // $('.premium-reports-table').html('<div class="text-center"><i class="fa fa-spinner fa-spin fa-2x fa-fw"></i><br/><br/>Loading reports...');
    premium_reports_datatable.destroy();
    premium_reports_datatable = $('.premium-reports-table > .table').DataTable({
      "processing": true,
      "serverSide": true,
      "ordering": false,
      "ajax": {
        data: {
          billing_date: $('option:selected', this).val()
        },
        url: "<%= employers_premium_statement_premium_statements_index_datatable_path(premium_statement_id: @employer_profile.id, :format => :json) %>",
        type: "GET"
      }
    });
  });
});
</script>
